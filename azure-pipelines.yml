# Maven
# Build your Java project and run tests with Apache Maven.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/java

trigger:
- develop

pool:
  name: Default

steps:
- task: JavaToolInstaller@0
  displayName: "Setup Java"
  inputs:
    versionSpec: "17"
    jdkArchitectureOption: x64
    jdkSourceOption: LocalDirectory
    jdkFile: "/root/installs/jdk-17.tar.gz"
    jdkDestinationDirectory: "/builds/binaries/externals"
    cleanDestinationDirectory: true

- task: CmdLine@2
  displayName: Build and Deploy
  inputs:
    script: |
        docker-compose -f ./deploy/docker-compose-dev.yml -p "middleware" build
        docker-compose -f ./deploy/docker-compose-dev.yml -p "middleware" up -d

